<h1 *ngIf="!post">Create a new post</h1>
<h1 *ngIf="post">Edit Post</h1>

<div fxLayout="row" fxLayoutAlign="space-between center">
  <a routerLink="../">Back</a>
  <span>
    <button *ngIf="availableActions.indexOf('ACCEPT') > -1" pButton label="Accept"
            (click)="executeAction('ACCEPT')"></button>
    <button *ngIf="availableActions.indexOf('SUSPEND') > -1" pButton label="Suspend"
            (click)="executeAction('SUSPEND')"></button>
  </span>
</div>

<form [formGroup]="postForm" novalidate>

  <div>
    <label>Title of your post</label>
    <input pInputText formControlName="name" required>
    <control-messages [control]="postForm.controls.name"></control-messages>
  </div>

  <div>
    <label>Content of your post</label>
    <textarea pInputTextarea formControlName="description" required></textarea>
    <control-messages [control]="postForm.controls.description"></control-messages>
  </div>

  <p>What is your post about?</p>
  <div>
    <span *ngFor="let category of board.postCategories">
      <p-checkbox name="postCategoriesMap" [value]="category" [label]="category"
                  formControlName="postCategories"></p-checkbox>
    </span>
  </div>

  <div>
    <label>Your organization</label>
    <input pInputText formControlName="organizationName" required>
    <control-messages [control]="postForm.controls.organizationName"></control-messages>
  </div>

  <div>
    <places-autocomplete formControlName="location"></places-autocomplete>
    <control-messages [control]="postForm.controls.location"></control-messages>
  </div>

  <div *ngIf="showExistingRelation">
    <div>
      <label>What is your relationship with our department?</label>
      <p-dropdown [options]="relations" formControlName="existingRelation"
                  placeholder="Select relationship..."></p-dropdown>
      <control-messages [control]="postForm.controls.existingRelation"></control-messages>
    </div>

    <div *ngIf="postForm.value.existingRelation">
      <label>
        {{'definitions.relationWithDepartment.' + postForm.value.existingRelation + ".explanationPrompt" |
        translate}}
      </label>
      <textarea pInputTextarea formControlName="existingRelationExplanation" required></textarea>
      <control-messages [control]="postForm.controls.existingRelationExplanation"></control-messages>
    </div>
  </div>

  <p>Who do you want to share your post with?</p>
  <div>
    <span *ngFor="let category of board.department.memberCategories">
      <p-checkbox name="memberCategoriesMap" [value]="category" [label]="category"
                  formControlName="memberCategories"></p-checkbox>
    </span>
  </div>

  <div>
    How will people respond?
    <p-radioButton value="website" name="applyType" formControlName="applyType"
                   label="By visiting a web page"></p-radioButton>
    <p-radioButton value="document" name="applyType" formControlName="applyType"
                   label="By following instructions in a document"></p-radioButton>
    <p-radioButton value="email" name="applyType" formControlName="applyType"
                   label="By sending an email"></p-radioButton>
    <control-messages [control]="postForm.controls.applyType"></control-messages>
  </div>

  <div *ngIf="postForm.value.applyType === 'website'">
    <label>Your website address</label>
    <input pInputText type="url" formControlName="applyWebsite" required>
    <control-messages [control]="postForm.controls.applyWebsite"></control-messages>
  </div>

  <div *ngIf="postForm.value.applyType === 'document'">
    <file-upload formControlName="applyDocument" type="document"></file-upload>
    <control-messages [control]="postForm.controls.applyDocument"></control-messages>
  </div>

  <div *ngIf="postForm.value.applyType === 'email'">
    <label>Email address</label>
    <input pInputText type="email" formControlName="applyEmail" placeholder="e.g. apply@example.com" required>
    <control-messages [control]="postForm.controls.applyEmail"></control-messages>
  </div>

  <div *ngIf="actionView === 'REVISE'" layout="column" layout-align="space-between stretch">
    <button pButton [disabled]="postForm.invalid" label="Accept"
            (click)="executeAction('ACCEPT', true)"></button>
    <button pButton class="ui-button-warning" [disabled]="postForm.invalid" label="Request Correction"
            (click)="executeAction('SUSPEND', true)"></button>
    <button pButton class="ui-button-danger" label="Reject" (click)="executeAction('REJECT')"></button>
  </div>

  <div *ngIf="actionView === 'CORRECT'" layout="column" layout-align="space-between stretch">
    <button pButton [disabled]="postForm.invalid" label="Correct" (click)="executeAction('CORRECT', true)"></button>
  </div>

  <div *ngIf="actionView === 'EDIT'" layout="column" layout-align="space-between stretch">
    <button pButton [disabled]="postForm.invalid" label="Save" (click)="save()"></button>
  </div>

  <div *ngIf="actionView === 'CREATE'" layout="column" layout-align="space-between stretch">
    <button pButton [disabled]="postForm.invalid" label="Submit" (click)="create()"></button>
  </div>

</form>
