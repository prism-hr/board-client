<section class="section">
  <div class="grid">
    <div class="grid__item medium-up--three-quarters small-one-whole post">
      <div class="post-title" fxLayout="row" fxLayoutAlign="space-between top">
        <div>
          <div *ngIf="publishedTimestamp" class="date">
            <div *ngIf="(publishedTimestamp | amDifference: today) >= 0">
              Going live: {{publishedTimestamp | amCalendar}}
            </div>
            <div *ngIf="(publishedTimestamp | amDifference: today) < 0">
              Published: {{publishedTimestamp | amCalendar}}
            </div>
          </div>
          <h1>{{post.name}}</h1>
          <h2><em>at</em> {{post.organizationName}} <span class="location"><i class="fa fa-location-pin"></i> {{post.location.name}}</span>
          </h2>
        </div>
        <b-resource-actions-box [resource]="post" class="admin-actions"></b-resource-actions-box>
      </div>
      <div class="post-content">
        <div class=" post-content--excerpt">
          {{post.summary}}
        </div>
        <div *ngIf="post.description" class="post-content--description" [innerHtml]="post.description">
        </div>
      </div>
      <div class="post-actions">
        <div class="post-actions-how-to">
          <h4>How to Apply?</h4>
          <div *ngIf="(user$ | async) === false" class="post-action-content">
            <a (click)="showLogin()">Login</a> to check this job offer contact details.
          </div>
          <div *ngIf="user$ | async" class="post-action-content">
            <div *ngIf="post.applyWebsite">
              Apply on this website <a href="{{post.applyWebsite}}"
                                       class="ui-button-success small ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"
                                       target="_blank"><span class="ui-button-text ui-c">Apply</span></a>
            </div>
            <div *ngIf="post.applyDocument">
              Download and follow the instructions on the following document:
              <a target="_blank" href="{{post.applyDocument.cloudinaryUrl}}">
                {{post.applyDocument.fileName}}
              </a>
            </div>
            <div *ngIf="post.applyEmail">
              Send an email to
              <a href="mailto:{{post.applyEmail}}">
                {{post.applyEmail}}
              </a>
            </div>
          </div>
        </div>
      </div>

      <share-buttons [title]="post.name" [description]="post.summary" [pinterest]="false" [stumbleUpOn]="false"
                     [reddit]="false" [reddit]="false" [whatsApp]="false" [tumblr]="false"
                     [image]="post.board.documentLogo?.cloudinaryUrl"></share-buttons>

    </div>
    <div class="grid__item medium-up--one-quarter small-one-whole publisher">
      <md-card>
        <md-card-header class="header-full">
          <md-card-title>
            <h3>Posted on</h3>
          </md-card-title>
        </md-card-header>
        <md-card-content>
          <div class="grid">
            <div class="grid__item one-whole">
              <div *ngIf="post.board.department.documentLogo" md-card-avatar class="logo-holder-small default-logo">
                <cl-image public-id="{{post.board.department.documentLogo.cloudinaryId}}"
                          class="img">
                  <cl-transformation gravity="north_west" height="150" width="200" crop="mfit"></cl-transformation>
                </cl-image>
              </div>
              <h3><a [routerLink]="['/', post.board.department.handle]">{{post.board.department.name}}</a></h3>
              <h4><a [routerLink]="['/', post.board.department.handle, post.board.handle]">{{post.board.name}}</a></h4>
            </div>
          </div>
        </md-card-content>
      </md-card>
      <div class="category-list">
        <span class="ui-chips-token  ui-corner-all" *ngFor="let category of post.postCategories">{{category}}</span>
      </div>
    </div>
  </div>
</section>
<section class="section post-timeline" *ngIf="operations">
  <h2>Post Timeline</h2>
  <ul>
    <li *ngFor="let operation of operations" class="action-{{ operation.action | lowercase }}">
      <time>
        <span class="post-timeline--time">{{operation.createdTimestamp | date:'shortTime'}}</span>
        <span class="post-timeline--day">{{operation.createdTimestamp | date:'shortDate'}}</span>
      </time>
      <div class="post-timeline--icon">
        <i class="fa fa-{{ operation.action | lowercase }}"></i>
      </div>
      <div class="post-timeline--label">
        <div *ngIf="operation.user" class="post-timeline--user">
          <h5>{{operation.user.givenName}} {{operation.user.surname}}
            <small>{{operation.user.email}}</small>
          </h5>
        </div>
        <div>{{'definitions.action.' + operation.action | translate}}</div>
        <div *ngIf="operation.comment">
          Comment: {{operation.comment}}
        </div>
        <div *ngIf="operation.changeList">
          <div>Changed properties:</div>
          <span *ngFor="let change of operation.changeList; let isLast=last">
            {{'resourceProperty.' + change.property | translate}}{{isLast ? '' : ', '}}
          </span>
          <button pButton type="button" (click)="openChangeDetails(operation)" label="Show details"></button>
        </div>
      </div>
    </li>
  </ul>
</section>

<p-dialog [(visible)]="showOperationDetails" *ngIf="selectedOperation">
  <p-header>
    Changes:
  </p-header>
  <div *ngFor="let change of selectedOperation.changeList" class="boards">
    Property: {{'resourceProperty.' + change.property | translate}}
    changed from
    {{change.oldValue | json}}
    to
    {{change.newValue | json}}
  </div>
  <p-footer>
    <h6>Otherwise create a new board:</h6>
    <a pButton routerLink="/newBoard" class="ui-button-success small" icon="fa-plus" label="New Board"></a>
  </p-footer>
</p-dialog>
